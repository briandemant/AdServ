/*! AdServ  0.1.2 2013-07-31 11:08:02 */
"use strict";
!function(a, b) {a.AdServ = b(a, a.document)}(window, function(a, b) {
	var c = a.AdServ || {};
	c.version = "0.1.2", c.released = "2013-07-31 11:08:02", a.AdServ = c;
	var d = a.console;
	d || (d = {}, d.log = d.error = function() {}), a.adServingLoad = a.adServingLoad || "";
	var e = Object.prototype.toString, f = Array.prototype.slice, g = encodeURIComponent;
	b.location;
	var h = a.ActiveXObject, i = function() {}, j = function(a) {return a && "function" == typeof a}, k = function(a) {return a && "object" == typeof a && "[object Object]" === e.call(a)}, l = function(a) {return a && "object" == typeof a && "[object Array]" === e.call(a)}, m = function(a) {return a && "string" == typeof a}, n = function(a) {return a ? 1 === a.nodeType : !1}, o = c.guid = function() {
		var a = function() {return(0 | 65536 * (1 + Math.random())).toString(16).substring(1)};
		return"ad_" + a() + "_" + a() + "_" + a() + "_" + a()
	}, p = function(a) {return a.length}, q = function(a, b) {
		var c, d = {};
		for (c in a) {
			a.hasOwnProperty(c) && (d[c] = a[c]);
		}
		for (c in b) {
			b.hasOwnProperty(c) && (d[c] = b[c]);
		}
		return d
	}, r = c.ready = function(a) {
		function c(a) {
			for (m = 1; a = e.shift();) {
				a()
			}
		}

		var d, e = [], f = !1, g = b.documentElement, h = g.doScroll, i = "DOMContentLoaded", j = "addEventListener", k = "onreadystatechange", l = "readyState", m = /^loade|c/.test(b[l]);
		return b[j] && b[j](i, d = function() {b.removeEventListener(i, d, f), c()}, f), h && b.attachEvent(k, d = function() {/^c/.test(b[l]) && (b.detachEvent(k, d), c())}), a = h ? function(b) {
			self != top ? m ? b() : e.push(b) : function() {
				try {g.doScroll("left")} catch (c) {return setTimeout(function() {a(b)}, 50)}
				b()
			}()
		} : function(a) {m ? a() : e.push(a)}
	}(), s = c.get = function(b, c) {
		var e, f;
		if (a.XDomainRequest) {
			f = new XDomainRequest, f.onprogress = function() {};
		} else if (a.XMLHttpRequest) {
			f = new XMLHttpRequest;
		} else {
			try {f = new h("Msxml2.XMLHTTP")} catch (g) {return null}
		}
		return e = setTimeout(function() {f.abort(), c("aborted by a timeout", null, f)}, 5e3), f.onreadystatechange = function() {4 == f.readyState && (f.onload = i, clearTimeout(e), c(200 != f.status ? "err : " + f.status : null, f.responseText, f))}, f.onload = function() {
			if (clearTimeout(e), f.status) {
				for (var a = 0; 10 > a; a++) {
					d.log("onload with status");
				}
				c(200 != f.status ? "err : " + f.status : null, f.responseText, f)
			} else {
				c(f.responseText ? null : "err : no response", f.responseText, f)
			}
		}, f.open("GET", b, !0), f.send(), f
	}, t = c.getJSON = function(a, b) {
		return s(a, function(a, c, d) {
			var e = c;
			a || (e = J(c)), b(a, e, d)
		})
	}, u = c.$ = function(a, c) {return n(a) ? a : (c || (c = b), c.querySelector(a))};
	c.$$ = function(a, c) {return c || (c = b), f.call(c.querySelectorAll(a))};
	var v;
	v = a.getComputedStyle ? a.getComputedStyle : function(a) {
		return this.el = u(a), this.getPropertyValue = function(b) {
			var c = /(\-([a-z]){1})/g;
			return"float" == b && (b = "styleFloat"), c.test(b) && (b = b.replace(c, function() {return arguments[2].toUpperCase()})), a.currentStyle[b] ? a.currentStyle[b] : null
		}, this
	};
	var w = c.css = function(a, b) {return a = u(a), v(u(a)).getPropertyValue(b)}, x = c.isVisible = function(a) {return a = u(a), a ? "BODY" === a.nodeName ? !0 : "hidden" == w(a, "visibility") ? !1 : "none" == w(a, "display") ? !1 : "0" == w(a, "opacity") ? !1 : x(a.parentNode) : !1}, y = {}, z = c.on = function(b, c, d) {y[b] = void 0 === y[b] ? [] : y[b], y[b].push(function(b) {return c.apply(d || a, b)})};
	c.once = function(a, b, c) {z(a, function() {b(), b = i}, c)};
	var A = c.emit = function(a) {
		if (void 0 !== y[a]) {
			for (var b = f.call(arguments, 1), c = 0; c < p(y[a]); c++) {
				y[a][c](b)
			}
		}
	}, B = a.onresize || i;
	a.onresize = function() {
		try {B()} catch (a) {}
		A("resize")
	}, r(function() {A("load")});
	var C = "0";
	if (h) {
		try {
			var D = new h("ShockwaveFlash.ShockwaveFlash");
			if (D) {
				var E = D.GetVariable("$version").substring(4);
				C = E.replace(",", ".")
			}
		} catch (F) {}
	} else {
		var G = a.navigator.plugins["Shockwave Flash"];
		G && G.description && (C = G.description.match(/(\d+)\.(\d+)/)[0])
	}
	C = parseFloat(C);
	var H = c.flash = C >= 6 ? C : !1, I = function(a, b, c, d) {this.params = {quality : "best"}, this.vars = {quality : "best"}, this.attrs = {swf : a, id : o(), w : c, h : d}};
	I.prototype = {addParam : function(a, b) {this.params[a] = b}, addVariable : function(a, b) {this.vars[a] = b}, getVars : function() {
		var a, b = [];
		for (a in this.vars) {
			b.push(a + "=" + this.vars[a]);
		}
		return b
	}, getSWFHTML : function() {
		var a, b = this.params, c = this.attrs, d = this.getVars().join("&"), e = ' width="' + c.w + '" height="' + c.h + '" id="' + c.id + '" name="flashfile"';
		if (h) {
			a = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + e + '><param name="movie" value="' + c.swf + '" />';
			for (f in b) {
				a += '<param name="' + f + '" value="' + b[f] + '" />';
			}
			p(d) > 0 && (a += '<param name="flashvars" value="' + d + '" />'), a += "</object>"
		} else {
			a = '<embed type="application/x-shockwave-flash" src="' + c.swf + '"' + e;
			for (var f in b) {
				a += f + '="' + b[f] + '" ';
			}
			a += 'flashvars="' + d + '"/>'
		}
		return a
	}, write : function(a) {
		if (H) {
			var b = u("#" + a);
			if (b) {
				return b.innerHTML = this.getSWFHTML(), !0
			}
		}
		return!1
	}}, a.baSWFObject = I;
	var J = c.parseJSON = JSON.parse, K = function(b) {
		c.baseUrl = c.baseUrl || "";
		for (var e = {baseUrl : c.baseUrl, xhrTimeout : 5e3}, f = 0; f < p(b); f++) {
			var g = b[f];
			j(g) ? e.ondone = g : k(g) ? e = q(e, g) : l(g) ? e.adspaces = g : m(g) && (e.baseUrl = g)
		}
		if (!l(e.adspaces)) {
			var h = a.ba_adspaces;
			if (!h || 0 === p(h) || h.loaded) {
				return d.error("adspaces empty"), !1;
			}
			h.loaded = !0, e.adspaces = h
		}
		var i = e.contexts = {}, n = e.adspaces;
		for (f = 0; f < p(n); f++) {
			var o = n[f];
			if (o.id > 0) {
				var r = o.context || "_GLOBAL_";
				o.context = i[r] = i[r] || {name : r, ids : [], adspaces : {}, keyword : o.keyword || "", searchword : o.searchword || "", adServingLoad : ""}, i[r].ids.push(o.id), i[r].adspaces[o.id] = o
			} else {
				d.error("no id", o)
			}
		}
		return e
	}, L = function(a, b) {
		var c = !1;
		return function() {c || (c = !0, a(), setTimeout(function() {a(), c = !1}, b))}
	}, M = function(a) {
		var c, e = a.ctx, f = e.conf;
		if (d.log("loading adspace " + a.adspace + " into " + a.target), a.campaign && a.banner && a.adspace) {
			var h = e.adspaces[a.adspace], i = "script_" + h.target + "_" + h.id, j = b.getElementById(i);
			if (j) {
				d.error("already loaded " + i);
			} else {
				j = b.createElement("script"), j.id = i, j.type = "text/javascript", j.async = !1, j.onload = j.onreadystatechange = function() {return function() {}}(a, e), j.src = f.baseUrl + "/api/v1/get/js_banner" + "?adspaceid=" + g(h.id) + "&campaignid=" + g(a.campaign) + "&bannerid=" + g(a.banner) + "&keywords=" + g(e.keyword) + "&appendTo=" + g(h.target);
				var k = b.getElementById(h.target);
				k.innerHTML = "", k.parentNode.insertBefore(j, k)
			}
		} else {
			c = f.baseUrl + "/api/v2/count/load?adspaceid=" + a.adspace + "&keyword=" + g(e.keyword) + "&searchword=" + g(e.searchword), s(c, function(a, b) {d.log(b)})
		}
	}, N = L(function() {
		for (var a = [], b = 0; b < p(P); b++) {
			var c = P[b];
			x("#" + c.target) ? (O && clearInterval(O), M(c)) : a.push(c)
		}
		P = a
	}, 200);
	c.on("resize", function() {O && clearInterval(O), N()});
	var O = 0, P = [];
	return c.loadAdspaces = function() {
		var a = K(arguments), b = 0;
		for (var c in a.contexts) {
			b++;
		}
		for (var e in a.contexts) {
			var f = a.contexts[e], h = a.baseUrl + "/api/v2/get/campaigns.json?adspaces=" + f.ids.join(",") + "&adServingLoad=" + g(f.adServingLoad) + "&keyword=" + g(f.keyword) + "&searchword=" + g(f.searchword);
			t(h, function(c) {
				return c.conf = a, function(a, e) {
					if (a) {
						d.error(a);
					} else {
						for (var f = e.campaigns, g = 0; g < p(f); g++) {
							var h = f[g];
							h.ctx = c, h.target = c.adspaces[h.adspace].target, P.push(h)
						}
					}
					--b, b || r(function() {N()})
				}
			}(f))
		}
		return a
	}, c
});