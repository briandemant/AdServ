/*! AdServ  0.0.2 2013-05-19 21:44:40 */
"use strict";(function(e,t){e.AdServ=t(e)})(this,function(scope){var AdServ=scope.AdServ||{};scope.AdServ=AdServ;var doc=scope.document;AdServ.conf={xhrTimeout:5e3,baseUrl:""},AdServ.get=function(e,t){var n,a;try{a=new XMLHttpRequest}catch(r){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){return null}}var o=function(){a.abort(),t("aborted by a timeout",null,a)};return n=setTimeout(o,AdServ.conf.xhrTimeout),a.onreadystatechange=function(){4==a.readyState&&(clearTimeout(n),t(200!=a.status?"err : "+a.status:!1,a.responseText,a))},a.open("GET",e,!0),a.send(),a},AdServ.getJSON=function(e,t){return AdServ.get(e,function(e,n,a){var r=n;e||(r=AdServ.parseJSON(n)),t(e,r,a)})};var eventHandlers={};AdServ.on=function(e,t,n){var a=function(){};eventHandlers[e]=void 0===eventHandlers[e]?[]:eventHandlers[e],n="object"==typeof n?n:scope,a=function(e){return t.apply(n,Array.prototype.slice.call(e,1))},eventHandlers[e].push(a)},AdServ.emit=function(e){if(void 0!==eventHandlers[e])for(var t=0;eventHandlers[e].length>t;t++)eventHandlers[e][t](arguments)},scope.AdServ=scope.AdServ||{},scope.AdServ.adspaces=scope.AdServ.adspaces||scope.ba_adspaces||[],scope.adServingLoad=scope.adServingLoad||"",AdServ.loadAdspaces=function(e){e||(e=AdServ.conf.baseUrl);var t,n={},a=[];AdServ.ready(function(){if(AdServ.adspaces&&0!=AdServ.adspaces.length){for(t=0;AdServ.adspaces.length>t;t++){var r,o=AdServ.adspaces[t];o.id>0&&(o.context=o.context||"_GLOBAL_",n[o.context]?r=n[o.context]:(r=n[o.context]={name:o.context,adspaces:[],keyword:o.keyword||"",searchword:o.searchword||""},a.push(o.context)),r[o.id]=o,r.adspaces.push(o.id))}var c=function(e,t){t.onload&&"function"==typeof t.onload&&t.onload(e,t),AdServ.emit("campaign",e,t)};for(c.waiting=0,c.results=[],AdServ.on("campaign",function(e,t){c.results.push([e,t]),1>--c.waiting&&(AdServ.onload&&"function"==typeof AdServ.onload&&AdServ.onload(c.results),AdServ.emit("done",c.results))}),t=0;a.length>t;t++){var d=a[t],s=n[d];if(s.adspaces&&s.adspaces.length>0){var i=e+"/api/v1/get/campaigns.json?adspaces="+s.adspaces.join(",")+"&keyword="+s.keyword+"&searchword="+s.searchword;AdServ.getJSON(i,function(t){return function(n,a){if(n)AdServ.emit("error",n),AdServ.emit("campaign",{error:n});else if(a.campaigns){c.waiting+=a.campaigns.length;for(var r=0;a.campaigns.length>r;r++){a.campaigns[r].found=!1;var o=a.campaigns[r];if(o.banner>0){var d=t[o.adspace],s=doc.getElementById(d.target);if(s.innerHTML="",o.campaign&&o.banner&&o.adspace){o.found=!0;var i="script_"+d.target+"_"+o.adspace,u=doc.getElementById(i);u?(AdServ.emit("error","already loaded "+i),c.waiting--):(u=doc.createElement("script"),u.id=i,u.type="text/javascript",u.async=!1,u.onload=u.onreadystatechange=function(e,t){return function(){c(e,t[e.adspace])}}(o,t),u.src=e+"/api/v1/get/js_banner"+"?adspaceid="+o.adspace+"&campaignid="+o.campaign+"&bannerid="+o.banner+"&appendTo="+d.target,s.parentNode.insertBefore(u,s))}}else c(o,t[o.adspace])}}}}(s))}}}})};var e=function(s){return eval("("+s+")")};return AdServ.parseJSON="object"==typeof JSON?JSON.parse:function(t){t+="";var n=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(n.test(t)&&(t=t.replace(n,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e(t);throw"JSON.parse"},AdServ.ready=function(e){function t(e){for(p=1;e=a.shift();)e()}var n,a=[],r=!1,o=doc.documentElement,c=o.doScroll,d="DOMContentLoaded",s="addEventListener",i="onreadystatechange",u="readyState",p=/^loade|c/.test(doc[u]);return doc[s]&&doc[s](d,n=function(){doc.removeEventListener(d,n,r),t()},r),c&&doc.attachEvent(i,n=function(){/^c/.test(doc[u])&&(doc.detachEvent(i,n),t())}),e=c?function(t){self!=top?p?t():a.push(t):function(){try{o.doScroll("left")}catch(n){return setTimeout(function(){e(t)},50)}t()}()}:function(e){p?e():a.push(e)}}(),AdServ});