/*! AdServ  0.0.9 2013-06-07 09:51:02 */
"use strict";!function(a,b){a.AdServ=b(a,a.document)}(window,function(a,b){var c=a.AdServ||{};c.version="0.0.9",c.released="2013-06-07 09:51:02",a.AdServ=c;var d=a.console;d||(c.history=[],d={},d.log=function(){var a=C.call(arguments);1==L(a)&&(a=a[0]),c.history.push(a)},d.error=function(){d.log.apply(null,arguments)}),a.adServingLoad=a.adServingLoad||"";var e=c.get=function(a,b){var c,d;try{d=new XMLHttpRequest}catch(e){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return null}}var f=function(){d.abort(),b("aborted by a timeout",null,d)};return c=setTimeout(f,5e3),d.onreadystatechange=function(){4==d.readyState&&(clearTimeout(c),b(200!=d.status?"err : "+d.status:null,d.responseText,d))},d.open("GET",a,!0),d.send(),d},f=c.getJSON=function(a,b){return e(a,function(a,c,d){var e=c;a||(e=A(c)),b(a,e,d)})},g=c.$=function(a,c){return J(a)?a:(c||(c=b),c.querySelector(a))};c.$$=function(a,c){return c||(c=b),C.call(c.querySelectorAll(a))};var h;h=a.getComputedStyle?a.getComputedStyle:function(a){return this.el=g(a),this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this};var i=c.css=function(a,b){return a=g(a),h(g(a)).getPropertyValue(b)},j=c.isVisible=function(a){return a=g(a),a?"BODY"===a.nodeName?!0:"hidden"==i(a,"visibility")?!1:"none"==i(a,"display")?!1:"0"==i(a,"opacity")?!1:j(a.parentNode):!1},k={},l=c.on=function(b,c,d){k[b]="undefined"==typeof k[b]?[]:k[b],k[b].push(function(b){return c.apply(d||a,b)})},m=c.once=function(a,b,c){l(a,function(){b(),b=E},c)},n=c.emit=function(a){if("undefined"!=typeof k[a])for(var b=C.call(arguments,1),c=0;c<L(k[a]);c++)k[a][c](b)},o=a.onresize||E;a.onresize=function(){try{o()}catch(a){}n("resize")};var p=!1,q=a.onload||E;a.onload=function(){p=!0;try{q()}catch(a){}n("load")};var r=function(a){p?a():m("load",a)};c.ready=r;var s,t=a.ActiveXObject;if(t)try{var u=new t("ShockwaveFlash.ShockwaveFlash");if(u){var v=u.GetVariable("$version").substring(4);s=v.replace(",",".")}}catch(w){}else{var x=a.navigator.plugins["Shockwave Flash"];x&&x.description&&(s=x.description.match(/(\d+)\.(\d+)/)[0])}var y=c.flash=s>=6?s:!1,z=function(a,b,c,d){this.params={quality:"best"},this.vars={quality:"best"},this.attrs={swf:a,id:K(),w:c,h:d}};z.prototype={addParam:function(a,b){this.params[a]=b},addVariable:function(a,b){this.vars[a]=b},getVars:function(){var a,b=[];for(a in this.vars)b.push(a+"="+this.vars[a]);return b},getSWFHTML:function(){var a,b=this.params,c=this.attrs,d=this.getVars().join("&"),e=' width="'+c.w+'" height="'+c.h+'" id="'+c.id+'" name="flashfile"';if(t){a='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+e+'><param name="movie" value="'+c.swf+'" />';for(f in b)a+='<param name="'+f+'" value="'+b[f]+'" />';L(d)>0&&(a+='<param name="flashvars" value="'+d+'" />'),a+="</object>"}else{a='<embed type="application/x-shockwave-flash" src="'+c.swf+'"'+e;for(var f in b)a+=f+'="'+b[f]+'" ';a+='flashvars="'+d+'"/>'}return a},write:function(a){if(y){var b=g("#"+a);if(b)return b.innerHTML=this.getSWFHTML(),!0}return!1}},a.baSWFObject=z;var A=c.parseJSON=JSON.parse,B=Object.prototype.toString,C=Array.prototype.slice,D=encodeURIComponent;b.location;var E=function(){},F=function(a){return a&&"function"==typeof a},G=function(a){return a&&"object"==typeof a&&"[object Object]"===B.call(a)},H=function(a){return a&&"object"==typeof a&&"[object Array]"===B.call(a)},I=function(a){return a&&"string"==typeof a},J=function(a){return a?1===a.nodeType:!1},K=c.guid=function(){var a=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return"ad_"+a()+"_"+a()+"_"+a()+"_"+a()},L=function(a){return a.length},M=function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},N=function(b){for(var c={baseUrl:"",xhrTimeout:5e3},e=0;e<L(b);e++){var f=b[e];F(f)?c.ondone=f:G(f)?c=M(c,f):H(f)?c.adspaces=f:I(f)&&(c.baseUrl=f)}if(!H(c.adspaces)){var g=a.ba_adspaces;if(!g||0===L(g)||g.loaded)return d.error("adspaces empty"),!1;g.loaded=!0,c.adspaces=g}var h=c.contexts={},i=c.adspaces;for(e=0;e<L(i);e++){var j=i[e];if(j.id>0){var k=j.context||"_GLOBAL_";j.context=h[k]=h[k]||{name:k,ids:[],adspaces:{},keyword:j.keyword||"",searchword:j.searchword||"",adServingLoad:""},h[k].ids.push(j.id),h[k].adspaces[j.id]=j}else d.error("no id",j)}return c},O=function(a,b){var c=!1;return function(){c||(c=!0,a(),setTimeout(function(){a(),c=!1},b))}},P=function(a){if(a.campaign&&a.banner&&a.adspace){d.log(a.target);var c=a.ctx,e=c.conf,f=c.adspaces[a.adspace],g="script_"+f.target+"_"+f.id,h=b.getElementById(g);if(h)d.error("already loaded "+g);else{h=b.createElement("script"),h.id=g,h.type="text/javascript",h.async=!1,h.onload=h.onreadystatechange=function(){return function(){}}(a,c),h.src=e.baseUrl+"/api/v1/get/js_banner"+"?adspaceid="+D(f.id)+"&campaignid="+D(a.campaign)+"&bannerid="+D(a.banner)+"&appendTo="+D(f.target);var i=b.getElementById(f.target);i.innerHTML="",i.parentNode.insertBefore(h,i)}}else d.log("COUNT empty view")},Q=O(function(){for(var a=[],b=0;b<L(R);b++){var c=R[b];j("#"+c.target)?P(c):a.push(c)}R=a},100);c.on("resize",Q);var R=[];return c.loadAdspaces=function(){var a=N(arguments);for(var b in a.contexts){var c=a.contexts[b],e=a.baseUrl+"/api/v1/get/campaigns.json?adspaces="+c.ids.join(",")+"&adServingLoad="+D(c.adServingLoad)+"&keyword="+D(c.keyword)+"&searchword="+D(c.searchword);f(e,function(b){return b.conf=a,function(a,c){if(a)d.log("error",a);else for(var e=c.campaigns,f=0;f<L(e);f++){var g=e[f];g.ctx=b,g.target=b.adspaces[g.adspace].target,R.push(g)}r(function(){d.timeEnd("ready");var a=setInterval(function(){Q(),0==L(R)&&(alert("no more adspaces to check"),clearInterval(a))},500)})}}(c))}return a},c});