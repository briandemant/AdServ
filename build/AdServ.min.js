/*! AdServ  0.0.3 2013-05-23 11:53:11 */
"use strict";!function(a,b){a.AdServ=b(a)}(this,function(scope){var AdServ=scope.AdServ||{};scope.AdServ=AdServ;var doc=scope.document;AdServ.conf={xhrTimeout:5e3,baseUrl:""},AdServ.get=function(a,b){var c,d;try{d=new XMLHttpRequest}catch(e){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return null}}var f=function(){d.abort(),b("aborted by a timeout",null,d)};return c=setTimeout(f,AdServ.conf.xhrTimeout),d.onreadystatechange=function(){4==d.readyState&&(clearTimeout(c),b(200!=d.status?"err : "+d.status:!1,d.responseText,d))},d.open("GET",a,!0),d.send(),d},AdServ.getJSON=function(a,b){return AdServ.get(a,function(a,c,d){var e=c;a||(e=AdServ.parseJSON(c)),b(a,e,d)})};var eventHandlers={};AdServ.on=function(a,b,c){eventHandlers[a]=void 0===eventHandlers[a]?[]:eventHandlers[a],eventHandlers[a].push(function(a){return b.apply(c||scope,a)})},AdServ.emit=function(a){if(void 0!==eventHandlers[a])for(var b=Array.prototype.slice.call(arguments,1),c=0;c<eventHandlers[a].length;c++)eventHandlers[a][c](b)},scope.AdServ=scope.AdServ||{},scope.AdServ.adspaces=scope.AdServ.adspaces||scope.ba_adspaces||[],scope.adServingLoad=scope.adServingLoad||"",AdServ.loadAdspaces=function(a){a||(a=AdServ.conf.baseUrl);var b,c={},d=[];AdServ.ready(function(){if(AdServ.adspaces&&0!=AdServ.adspaces.length){for(b=0;b<AdServ.adspaces.length;b++){var e,f=AdServ.adspaces[b];f.id>0&&(f.context=f.context||"_GLOBAL_",c[f.context]?e=c[f.context]:(e=c[f.context]={name:f.context,adspaces:[],keyword:f.keyword||"",searchword:f.searchword||""},d.push(f.context)),e[f.id]=f,e.adspaces.push(f.id))}var g=function(a,b){b.onload&&"function"==typeof b.onload&&b.onload(a,b),AdServ.emit("campaign",a,b)};for(g.waiting=0,g.results=[],AdServ.on("campaign",function(a,b){g.results.push([a,b]),--g.waiting<1&&(AdServ.onload&&"function"==typeof AdServ.onload&&AdServ.onload(g.results),AdServ.emit("done",g.results))}),b=0;b<d.length;b++){var h=d[b],i=c[h];if(i.adspaces&&i.adspaces.length>0){var j=a+"/api/v1/get/campaigns.json?adspaces="+i.adspaces.join(",")+"&keyword="+i.keyword+"&searchword="+i.searchword;AdServ.getJSON(j,function(b){return function(c,d){if(c)AdServ.emit("error",c),AdServ.emit("campaign",{error:c});else if(d.campaigns){g.waiting+=d.campaigns.length;for(var e=0;e<d.campaigns.length;e++){d.campaigns[e].found=!1;var f=d.campaigns[e];if(f.banner>0){var h=b[f.adspace],i=doc.getElementById(h.target);if(i.innerHTML="",f.campaign&&f.banner&&f.adspace){f.found=!0;var j="script_"+h.target+"_"+f.adspace,k=doc.getElementById(j);k?(AdServ.emit("error","already loaded "+j),g.waiting--):(k=doc.createElement("script"),k.id=j,k.type="text/javascript",k.async=!1,k.onload=k.onreadystatechange=function(a,b){return function(){g(a,b[a.adspace])}}(f,b),k.src=a+"/api/v1/get/js_banner"+"?adspaceid="+f.adspace+"&campaignid="+f.campaign+"&bannerid="+f.banner+"&appendTo="+h.target,i.parentNode.insertBefore(k,i))}}else g(f,b[f.adspace])}}}}(i))}}}})};var e=function(s){return eval("("+s+")")};AdServ.parseJSON="object"==typeof JSON?JSON.parse:function(a){a+="";var b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(b.test(a)&&(a=a.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e(a);throw"JSON.parse"},AdServ.ready=function(a){function b(a){for(l=1;a=d.shift();)a()}var c,d=[],e=!1,f=doc.documentElement,g=f.doScroll,h="DOMContentLoaded",i="addEventListener",j="onreadystatechange",k="readyState",l=/^loade|c/.test(doc[k]);return doc[i]&&doc[i](h,c=function(){doc.removeEventListener(h,c,e),b()},e),g&&doc.attachEvent(j,c=function(){/^c/.test(doc[k])&&(doc.detachEvent(j,c),b())}),a=g?function(b){self!=top?l?b():d.push(b):function(){try{f.doScroll("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){l?a():d.push(a)}}();var eventHandlers={};return AdServ.getElem=function(a){return a},AdServ.getComputedStyle=window.getComputedStyle?window.getComputedStyle:function(a){return this.el=AdServ.getElem(a),this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this},AdServ});