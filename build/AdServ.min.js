/*! AdServ  0.0.2 2013-05-22 11:0:31 */
"use strict";(function(e,t){e.AdServ=t(e)})(this,function(scope){var AdServ=scope.AdServ||{};scope.AdServ=AdServ;var doc=scope.document;AdServ.conf={xhrTimeout:5e3,baseUrl:""},AdServ.get=function(e,t){var n,r;try{r=new XMLHttpRequest}catch(a){try{r=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){return null}}var o=function(){r.abort(),t("aborted by a timeout",null,r)};return n=setTimeout(o,AdServ.conf.xhrTimeout),r.onreadystatechange=function(){4==r.readyState&&(clearTimeout(n),t(200!=r.status?"err : "+r.status:!1,r.responseText,r))},r.open("GET",e,!0),r.send(),r},AdServ.getJSON=function(e,t){return AdServ.get(e,function(e,n,r){var a=n;e||(a=AdServ.parseJSON(n)),t(e,a,r)})};var eventHandlers={};AdServ.on=function(e,t,n){var r=function(){};eventHandlers[e]=void 0===eventHandlers[e]?[]:eventHandlers[e],n="object"==typeof n?n:scope,r=function(e){return t.apply(n,Array.prototype.slice.call(e,1))},eventHandlers[e].push(r)},AdServ.emit=function(e){if(void 0!==eventHandlers[e])for(var t=0;eventHandlers[e].length>t;t++)eventHandlers[e][t](arguments)},scope.AdServ=scope.AdServ||{},scope.AdServ.adspaces=scope.AdServ.adspaces||scope.ba_adspaces||[],scope.adServingLoad=scope.adServingLoad||"",AdServ.loadAdspaces=function(e){e||(e=AdServ.conf.baseUrl);var t,n={},r=[];AdServ.ready(function(){if(AdServ.adspaces&&0!=AdServ.adspaces.length){for(t=0;AdServ.adspaces.length>t;t++){var a,o=AdServ.adspaces[t];o.id>0&&(o.context=o.context||"_GLOBAL_",n[o.context]?a=n[o.context]:(a=n[o.context]={name:o.context,adspaces:[],keyword:o.keyword||"",searchword:o.searchword||""},r.push(o.context)),a[o.id]=o,a.adspaces.push(o.id))}var d=function(e,t){t.onload&&"function"==typeof t.onload&&t.onload(e,t),AdServ.emit("campaign",e,t)};for(d.waiting=0,d.results=[],AdServ.on("campaign",function(e,t){d.results.push([e,t]),1>--d.waiting&&(AdServ.onload&&"function"==typeof AdServ.onload&&AdServ.onload(d.results),AdServ.emit("done",d.results))}),t=0;r.length>t;t++){var c=r[t],s=n[c];if(s.adspaces&&s.adspaces.length>0){var i=e+"/api/v1/get/campaigns.json?adspaces="+s.adspaces.join(",")+"&keyword="+s.keyword+"&searchword="+s.searchword;AdServ.getJSON(i,function(t){return function(n,r){if(n)AdServ.emit("error",n),AdServ.emit("campaign",{error:n});else if(r.campaigns){d.waiting+=r.campaigns.length;for(var a=0;r.campaigns.length>a;a++){r.campaigns[a].found=!1;var o=r.campaigns[a];if(o.banner>0){var c=t[o.adspace],s=doc.getElementById(c.target);if(s.innerHTML="",o.campaign&&o.banner&&o.adspace){o.found=!0;var i="script_"+c.target+"_"+o.adspace,u=doc.getElementById(i);u?(AdServ.emit("error","already loaded "+i),d.waiting--):(u=doc.createElement("script"),u.id=i,u.type="text/javascript",u.async=!1,u.onload=u.onreadystatechange=function(e,t){return function(){d(e,t[e.adspace])}}(o,t),u.src=e+"/api/v1/get/js_banner"+"?adspaceid="+o.adspace+"&campaignid="+o.campaign+"&bannerid="+o.banner+"&appendTo="+c.target,s.parentNode.insertBefore(u,s))}}else d(o,t[o.adspace])}}}}(s))}}}})};var e=function(s){return eval("("+s+")")};AdServ.parseJSON="object"==typeof JSON?JSON.parse:function(t){t+="";var n=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;if(n.test(t)&&(t=t.replace(n,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(t.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e(t);throw"JSON.parse"},AdServ.ready=function(e){function t(e){for(p=1;e=r.shift();)e()}var n,r=[],a=!1,o=doc.documentElement,d=o.doScroll,c="DOMContentLoaded",s="addEventListener",i="onreadystatechange",u="readyState",p=/^loade|c/.test(doc[u]);return doc[s]&&doc[s](c,n=function(){doc.removeEventListener(c,n,a),t()},a),d&&doc.attachEvent(i,n=function(){/^c/.test(doc[u])&&(doc.detachEvent(i,n),t())}),e=d?function(t){self!=top?p?t():r.push(t):function(){try{o.doScroll("left")}catch(n){return setTimeout(function(){e(t)},50)}t()}()}:function(e){p?e():r.push(e)}}();var eventHandlers={};return AdServ.getElem=function(e){return e},AdServ.getComputedStyle=window.getComputedStyle?window.getComputedStyle:function(e){return this.el=AdServ.getElem(e),this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this},AdServ});