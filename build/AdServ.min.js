/*! AdServ  0.1.1 2013-06-24 14:08:04 */
"use strict";!function(a,b){a.AdServ=b(a,a.document)}(window,function(a,b){var c=a.AdServ||{};c.version="0.1.1",c.released="2013-06-24 14:08:04",a.AdServ=c;var d=a.console;d||(c.history=[],d={},d.log=function(){var a=B.call(arguments);1==K(a)&&(a=a[0]),c.history.push(a)},d.error=function(){d.log.apply(null,arguments)}),a.adServingLoad=a.adServingLoad||"";var e=c.ready=function(a){function c(a){for(m=1;a=e.shift();)a()}var d,e=[],f=!1,g=b.documentElement,h=g.doScroll,i="DOMContentLoaded",j="addEventListener",k="onreadystatechange",l="readyState",m=/^loade|c/.test(b[l]);return b[j]&&b[j](i,d=function(){b.removeEventListener(i,d,f),c()},f),h&&b.attachEvent(k,d=function(){/^c/.test(b[l])&&(b.detachEvent(k,d),c())}),a=h?function(b){self!=top?m?b():e.push(b):function(){try{g.doScroll("left")}catch(c){return setTimeout(function(){a(b)},50)}b()}()}:function(a){m?a():e.push(a)}}(),f=function(a){d.log("using "+a),f=D},g=function(a){d.log("using "+a),g=D},h=c.get=function(b,c){var e,h;if(a.XDomainRequest)f("XDomainRequest"),h=new XDomainRequest;else if(a.XMLHttpRequest)f("XMLHttpRequest"),h=new XMLHttpRequest;else try{h=new ActiveXObject("Msxml2.XMLHTTP"),f("XMLHTTP")}catch(i){return null}var j=function(){h.abort(),c("aborted by a timeout",null,h)};return e=setTimeout(j,5e3),h.onreadystatechange=function(){4==h.readyState&&(g("onreadystatechange"),h.onload=D,clearTimeout(e),c(200!=h.status?"err : "+h.status:null,h.responseText,h))},h.onload=function(){if(g("onload"),clearTimeout(e),h.status){for(var a=0;10>a;a++)d.log("onload with status");c(200!=h.status?"err : "+h.status:null,h.responseText,h)}else c(h.responseText?null:"err : no response",h.responseText,h)},h.open("GET",b,!0),h.send(),h},i=c.getJSON=function(a,b){return h(a,function(a,c,d){var e=c;a||(e=z(c)),b(a,e,d)})},j=c.$=function(a,c){return I(a)?a:(c||(c=b),c.querySelector(a))};c.$$=function(a,c){return c||(c=b),B.call(c.querySelectorAll(a))};var k;k=a.getComputedStyle?a.getComputedStyle:function(a){return this.el=j(a),this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;return"float"==b&&(b="styleFloat"),c.test(b)&&(b=b.replace(c,function(){return arguments[2].toUpperCase()})),a.currentStyle[b]?a.currentStyle[b]:null},this};var l=c.css=function(a,b){return a=j(a),k(j(a)).getPropertyValue(b)},m=c.isVisible=function(a){return a=j(a),a?"BODY"===a.nodeName?!0:"hidden"==l(a,"visibility")?!1:"none"==l(a,"display")?!1:"0"==l(a,"opacity")?!1:m(a.parentNode):!1},n={},o=c.on=function(b,c,d){n[b]="undefined"==typeof n[b]?[]:n[b],n[b].push(function(b){return c.apply(d||a,b)})};c.once=function(a,b,c){o(a,function(){b(),b=D},c)};var p=c.emit=function(a){if("undefined"!=typeof n[a])for(var b=B.call(arguments,1),c=0;c<K(n[a]);c++)n[a][c](b)},q=a.onresize||D;a.onresize=function(){try{q()}catch(a){}p("resize")},e(function(){p("load")});var r,s=a.ActiveXObject;if(s)try{var t=new s("ShockwaveFlash.ShockwaveFlash");if(t){var u=t.GetVariable("$version").substring(4);r=u.replace(",",".")}}catch(v){}else{var w=a.navigator.plugins["Shockwave Flash"];w&&w.description&&(r=w.description.match(/(\d+)\.(\d+)/)[0])}var x=c.flash=r>=6?r:!1,y=function(a,b,c,d){this.params={quality:"best"},this.vars={quality:"best"},this.attrs={swf:a,id:J(),w:c,h:d}};y.prototype={addParam:function(a,b){this.params[a]=b},addVariable:function(a,b){this.vars[a]=b},getVars:function(){var a,b=[];for(a in this.vars)b.push(a+"="+this.vars[a]);return b},getSWFHTML:function(){var a,b=this.params,c=this.attrs,d=this.getVars().join("&"),e=' width="'+c.w+'" height="'+c.h+'" id="'+c.id+'" name="flashfile"';if(s){a='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+e+'><param name="movie" value="'+c.swf+'" />';for(f in b)a+='<param name="'+f+'" value="'+b[f]+'" />';K(d)>0&&(a+='<param name="flashvars" value="'+d+'" />'),a+="</object>"}else{a='<embed type="application/x-shockwave-flash" src="'+c.swf+'"'+e;for(var f in b)a+=f+'="'+b[f]+'" ';a+='flashvars="'+d+'"/>'}return a},write:function(a){if(x){var b=j("#"+a);if(b)return b.innerHTML=this.getSWFHTML(),!0}return!1}},a.baSWFObject=y;var z=c.parseJSON=JSON.parse,A=Object.prototype.toString,B=Array.prototype.slice,C=encodeURIComponent;b.location;var D=function(){},E=function(a){return a&&"function"==typeof a},F=function(a){return a&&"object"==typeof a&&"[object Object]"===A.call(a)},G=function(a){return a&&"object"==typeof a&&"[object Array]"===A.call(a)},H=function(a){return a&&"string"==typeof a},I=function(a){return a?1===a.nodeType:!1},J=c.guid=function(){var a=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return"ad_"+a()+"_"+a()+"_"+a()+"_"+a()},K=function(a){return a.length},L=function(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);for(c in b)b.hasOwnProperty(c)&&(d[c]=b[c]);return d},M=function(b){c.baseUrl=c.baseUrl||"";for(var e={baseUrl:c.baseUrl,xhrTimeout:5e3},f=0;f<K(b);f++){var g=b[f];E(g)?e.ondone=g:F(g)?e=L(e,g):G(g)?e.adspaces=g:H(g)&&(e.baseUrl=g)}if(!G(e.adspaces)){var h=a.ba_adspaces;if(!h||0===K(h)||h.loaded)return d.error("adspaces empty"),!1;h.loaded=!0,e.adspaces=h}var i=e.contexts={},j=e.adspaces;for(f=0;f<K(j);f++){var k=j[f];if(k.id>0){var l=k.context||"_GLOBAL_";k.context=i[l]=i[l]||{name:l,ids:[],adspaces:{},keyword:k.keyword||"",searchword:k.searchword||"",adServingLoad:""},i[l].ids.push(k.id),i[l].adspaces[k.id]=k}else d.error("no id",k)}return e},N=function(a,b){var c=!1;return function(){c||(c=!0,a(),setTimeout(function(){a(),c=!1},b))}},O=function(a){var c,e=a.ctx,f=e.conf;if(d.log("loading adspace "+a.adspace+" into "+a.target),a.campaign&&a.banner&&a.adspace){var g=e.adspaces[a.adspace],i="script_"+g.target+"_"+g.id,j=b.getElementById(i);if(j)d.error("already loaded "+i);else{j=b.createElement("script"),j.id=i,j.type="text/javascript",j.async=!1,j.onload=j.onreadystatechange=function(){return function(){}}(a,e),j.src=f.baseUrl+"/api/v1/get/js_banner"+"?adspaceid="+C(g.id)+"&campaignid="+C(a.campaign)+"&bannerid="+C(a.banner)+"&appendTo="+C(g.target);var k=b.getElementById(g.target);k.innerHTML="",k.parentNode.insertBefore(j,k),c=f.baseUrl+"/api/v2/count/view?adspaceid="+a.adspace+"&campaignid="+C(a.campaign)+"&bannerid="+C(a.banner)+"&keyword="+C(e.keyword)+"&searchword="+C(e.searchword),h(c,function(a,b){d.log(b)})}}else c=f.baseUrl+"/api/v2/count/load?adspaceid="+a.adspace+"&keyword="+C(e.keyword)+"&searchword="+C(e.searchword),h(c,function(a,b){d.log(b)})},P=N(function(){for(var a=[],b=0;b<K(R);b++){var c=R[b];m("#"+c.target)?(Q&&clearInterval(Q),O(c)):a.push(c)}R=a},200);c.on("resize",function(){Q&&clearInterval(Q),P()});var Q=0,R=[];return c.loadAdspaces=function(){var a=M(arguments),b=0;for(var c in a.contexts)b++;for(var f in a.contexts){var g=a.contexts[f],h=a.baseUrl+"/api/v2/get/campaigns.json?adspaces="+g.ids.join(",")+"&adServingLoad="+C(g.adServingLoad)+"&keyword="+C(g.keyword)+"&searchword="+C(g.searchword);i(h,function(c){return c.conf=a,function(a,f){if(a)d.error(a);else for(var g=f.campaigns,h=0;h<K(g);h++){var i=g[h];i.ctx=c,i.target=c.adspaces[i.adspace].target,R.push(i)}--b,b||e(function(){P()})}}(g))}return a},c});