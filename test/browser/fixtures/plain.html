<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<SocketStream>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">
	<title>Test Setup</title>
	<script type="text/javascript">
		isIE = isIE8 = isIE9 = isIE10 = false;
		isStandAlone = (window.parent === window.top);
		template = document.location.href.replace(/.*\/([a-z_]+).html/, "$1");
		if (typeof console === 'undefined') {
			console = {				log : function(msg) { false && alert(msg)} 			};
		}
		console.debug = console.debug || function(msg) { console.log("DEBUG: " + msg)};
		console.debug('loading ' + template);
		if (isStandAlone) {
			//alert('stand alone!');
		} else {
			window.parent.iframe.beforeLoad(window, document);
		} 
	</script>
	<!--[if lt IE 8]><script type="text/javascript">alert('this browser is not supported')</script><![endif]-->
	<!--[if IE 8]><script type="text/javascript">isIE = isIE8 = true;</script><![endif]-->
	<!--[if IE 9]><script type="text/javascript">isIE = isIE9 = true;</script><![endif]-->
	<!--[if gt IE 9]><script type="text/javascript">isIE = isIE10 = true;</script><![endif]-->
	<link rel="stylesheet" href="test.css"/>
	<script> 
		/* (function(win) {

			win.xhr_requests = [];
			function intercept(method,url) {
				console.debug(method, url)
				win.xhr_requests.push({method: method, url:url});  
			}
			
			var xhr_type;
			// branch for native XMLHttpRequest object
			if (win.XMLHttpRequest && !(win.ActiveXObject)) {

				xhr_type = 'XMLHttpRequest';

// branch for IE/Windows ActiveX version
			} else if (win.ActiveXObject) {
				try {

					a = new ActiveXObject('Msxml2.XMLHTTP');

					xhr_type = 'Msxml2.XMLHTTP';

				} catch (e) {

					a = new ActiveXObject('Microsoft.XMLHTTP');

					xhr_type = 'Microsoft.XMLHTTP';

				}

			}

			var ActualActiveXObject = win.ActiveXObject;
			var ActiveXObject;

			if (xhr_type == 'XMLHttpRequest') {

				(function(open) {
					XMLHttpRequest.prototype.open = function(method, url, async, user, pass) {
						intercept(method, url);
						open.call(this, method, url + ".ua", async, user, pass);
					};
				})(XMLHttpRequest.prototype.open);

			} else {

				ActiveXObject = function(progid) {
					var ax = new ActualActiveXObject(progid);

					if (progid.toLowerCase() == "microsoft.xmlhttp") {
						var o = {
							_ax : ax,
							_status : "fake",
							responseText : "",
							responseXml : null,
							readyState : 0,
							dataType : 'plain',
							status : 0,
							statusText : 0,
							onReadyStateChange : null,
							onreadystatechange : null
						};
						o._onReadyStateChange = function() {
							var self = o;
							return function() {
								self.readyState = self._ax.readyState;
								if (self.readyState == 4) {

									self.responseText = self._ax.responseText;
									self.responseXml = self._ax.responseXml;
									self.status = self._ax.status;
									self.statusText = self._ax.statusText;

								}
								if (self.onReadyStateChange) {
									self.onReadyStateChange();
								}
								if (self.onreadystatechange) {
									self.onreadystatechange();
								}
							}
						}();
						o.open = function(bstrMethod, bstrUrl, varAsync, bstrUser, bstrPassword) {
							this._ax.onReadyStateChange = this._onReadyStateChange;
							this._ax.onreadystatechange = this._onReadyStateChange;
							intercept(bstrMethod, bstrUrl);
							return this._ax.open(bstrMethod, bstrUrl, varAsync, bstrUser, bstrPassword);
						};
						o.send = function(varBody) {
							return this._ax.send(varBody);
						};
						o.abort = function() {
							return this._ax.abort();
						}
						o.setRequestHeader = function(k, v) {
							return this._ax.setRequestHeader(k, v)
						}
						o.setrequestheader = function(k, v) {
							return this._ax.setRequestHeader(k, v)
						}
						o.getResponseHeader = function(k) {
							return this._ax.getResponseHeader(k)
						}
						o.getresponseheader = function(k) {
							return this._ax.getResponseHeader(k)
						}

					} else if (progid.toLowerCase() == "msxml2.xmlhttp") {
						var o = {
							_ax : ax,
							_status : "fake",
							responseText : "",
							responseXml : null,
							readyState : 0,
							dataType : 'plain',
							status : 0,
							statusText : 0,
							onReadyStateChange : null,
							onreadystatechange : null
						};
						o._onReadyStateChange = function() {
							var self = o;
							return function() {
								self.readyState = self._ax.readyState;
								if (self.readyState == 4) {

									self.responseText = self._ax.responseText;
									self.responseXml = self._ax.responseXml;
									self.status = self._ax.status;
									self.statusText = self._ax.statusText;

								}
								if (self.onReadyStateChange) {
									self.onReadyStateChange();
								}
								if (self.onreadystatechange) {
									self.onreadystatechange();
								}
							}
						}();
						o.open = function(bstrMethod, bstrUrl, varAsync, bstrUser, bstrPassword) {
							this._ax.onReadyStateChange = this._onReadyStateChange;
							this._ax.onreadystatechange = this._onReadyStateChange;
							intercept(bstrMethod, bstrUrl);
							return this._ax.open(bstrMethod, bstrUrl, varAsync, bstrUser, bstrPassword);
						};
						o.send = function(varBody) {
							return this._ax.send(varBody);
						};
						o.abort = function() {
							return this._ax.abort();
						}
						o.setRequestHeader = function(k, v) {
							return this._ax.setRequestHeader(k, v)
						}
						o.setrequestheader = function(k, v) {
							return this._ax.setRequestHeader(k, v)
						}
						o.getResponseHeader = function(k) {
							return this._ax.getResponseHeader(k)
						}
						o.getresponseheader = function(k) {
							return this._ax.getResponseHeader(k)
						}

					} else {
						var o = ax;
					}

					return o;
				}

			}
		})(window);
		*/

	</script>
</head>
<body>
	<div id="console_log"></div>
	<!-- ################################################################################################### -->
	<!-- Fixtrue content START ############################################################################# -->
	<!-- ################################################################################################### -->
	<div class="fixture_content">
	<h1>Plain</h1>

	<h3>Manuel checks:</h3>
	<ul>
		<li>No console errors</li>
	</ul>
	<div id='with-style' style='visibility: inherit;display:none;'></div>
	<div id='without-style' class='with-class'></div>
	<div id='hidden'>
		<div id="parent-hidden"></div>
	</div>
	<div id='opaque'>
		<div id="parent-opaque"></div>
	</div>
	<div id='not-displayed'>div#parent-not-displayed</div>
	<div id="group1" class="group">
		<h3 id="group1-child">Gruppe 1</h3>

		<p>Dette er en beskrivelse af denne banner gruppe</p>

		<div class="banners">
			<div id="banner1-1" class="first banner">banner 1</div>
			<div id="banner1-2" class="banner">banner 2</div>
			<div id="banner1-3">banner 3</div>
			<div id="banner1-4">banner 4</div>
		</div>
		<div class="status">
			<div id="banner1-1-status" class="first banner">banner 1</div>
			<div id="banner1-2-status" class="banner">banner 2</div>
			<div id="banner1-3-status" class="banner">banner 3</div>
			<div id="banner1-4-status" class="banner">banner 4</div>
		</div>
	</div>
	<script type="text/javascript">
		var adspaces = []
		adspaces.push({ id : '2', target : 'banner1-2' });
		adspaces.push({ id : '1', target : 'banner1-1' });
		adspaces.push({ id : '3', target : 'banner1-3' });
		adspaces.push({ id : '4', target : 'banner1-4' });
	</script>
	<script type="text/javascript"> 
		var scriptLoadCount = 0;

		var resizeFired = false;
		var onloadFired = false;
		window.onresize = function() {
			resizeFired = true;
		};
		window.onload = function() {
			onloadFired = true;
		};
		
	</script>

	<script type="text/javascript">
		(function() {
			var url = "http://" + document.location.hostname + ":9877";
			var script = document.createElement("script");
			script.type = "text/javascript";
			script.async = false;
			// server on a diff port
//			script.src = "http://jv.adservinginternational.com/api/v2/js/adserv.js";
//			script.src = "http://test.fmadserving.dk/api/v2/js/adserv.js";
			script.src = url + "/api/v2/js/adserv.js";
//			script.src = url + "/api/v2/js/adserv.min.js";
			// hook for test only .. start
			var callback = function() { 
				window.scriptLoadCount++;
				if (!isStandAlone && window.scriptLoadCount == 1) {
					window.parent.iframe.readyForTest(window, document);
				}
				if (window.scriptLoadCount > 1) {
					throw "onload fired twice!";
				}
				AdServ.keyword = AdServ.keyword || template;
				AdServ.baseUrl = url;
				AdServ.load(adspaces);
			};
			if (script.addEventListener) { 
				script.addEventListener("load", callback, false);
			} else if (script.readyState) {
				script.onreadystatechange = function() {
					if (script.readyState == 'loaded') {
				//alert("ie bug?");
						callback();
					}
				};
			}
			//  hook for test only .. end

			var first = document.getElementsByTagName("script")[0];
			first.parentNode.insertBefore(script, first);
		})();
	</script>
	</div>
	<!-- ################################################################################################### -->
	<!-- Fixtrue content END ############################################################################### -->
	<!-- ################################################################################################### -->

	<!-- Final test setup -->
	<script type="text/javascript"> 
		// make sure es5-shim.js is not applied 
		var isShimApplied = (isIE8) && typeof Array.isArray == 'function';

		var orgOnload = window.onload || function () {};
		window.onload = function() {
			orgOnload();
			if (!isStandAlone) {
				// trigger test start
				setTimeout(function () {
					window.parent.iframe.readyForTest(window, document);
				},10)
			}
		};
	</script>
</body>
</html> 